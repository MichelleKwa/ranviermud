'use strict';

const Axo = require('axolemma');

module.exports = (srcPath) => {
  const Broadcast = require(srcPath + 'Broadcast');
  const PlayerRoles = require(srcPath + 'PlayerRoles');

  const Room = require(srcPath + 'Room');
  const Area = require(srcPath + 'Area');

  return {
    requiredRole: PlayerRoles.ADMIN,

    command: state => (args, player) => {
      const { AreaManager } = state;
      const bundle = 'axo-test';

      const {graphic, rooms: area} = Axo.generate({
        type: 'Digger',
        areaTitle: args,
        areaInfo: 'Generated by Axolemma',
        roomDugPercentage: '10'
      });

      Broadcast.sayAt(player, 'Generated: ');
      Broadcast.sayAt(player, graphic);

      const {manifest, rooms} = area;

      const newArea = new Area(bundle, args, manifest);

      const newRooms = rooms.map(room =>
        new Room(
          area,
          Object.assign(
            room,
            {
              metadata: { axolemmaGenerated: true }
              
            })
        )
      )
    }
  };
};
